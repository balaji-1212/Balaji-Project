"use strict";window.XdUtils=window.XdUtils||{extend:function(e,t){var n,o=t||{};for(n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);return o}},window.xdLocalStorage=window.xdLocalStorage||function(){function t(e){var t;try{t=JSON.parse(e.data)}catch(e){}t&&t.namespace===r&&("iframe-ready"===t.id?(u=!0,s.initCallback()):d[(e=t).id]&&(d[e.id](e),delete d[e.id]))}function o(e,t,n,o){d[++c]=o;o={namespace:r,id:c,action:e,key:t,value:n};l.contentWindow.postMessage(JSON.stringify(o),"*")}function n(e){s=XdUtils.extend(e,s);e=document.createElement("div");window.addEventListener?window.addEventListener("message",t,!1):window.attachEvent("onmessage",t),e.innerHTML='<iframe id="'+s.iframeId+'" src='+s.iframeUrl+' style="display: none;"></iframe>',document.body.appendChild(e),l=document.getElementById(s.iframeId)}function i(){return m?u||(console.log("You must wait for iframe ready message before using the api."),0):(console.log("You must call xdLocalStorage.init() before using it."),0)}function a(){return"complete"===document.readyState}var l,r="cross-domain-local-message",s={iframeId:"cross-domain-iframe",iframeUrl:void 0,initCallback:function(){}},c=-1,d={},m=!1,u=!0;return{init:function(e){if(!e.iframeUrl)throw"You must specify iframeUrl";m?console.log("xdLocalStorage was already initialized!"):(m=!0,a()?n(e):document.addEventListener?document.addEventListener("readystatechange",function(){a()&&n(e)}):document.attachEvent("readystatechange",function(){a()&&n(e)}))},setItem:function(e,t,n){i()&&o("set",e,t,n)},getItem:function(e,t){i()&&o("get",e,null,t)},removeItem:function(e,t){i()&&o("remove",e,null,t)},key:function(e,t){i()&&o("key",e,null,t)},getSize:function(e){i()&&o("size",null,null,e)},getLength:function(e){i()&&o("length",null,null,e)},clear:function(e){i()&&o("clear",null,null,e)},wasInit:function(){return m}}}(),function(o,s){var c={init:function(e){c.hasContent=!1,c.templatePasteButton=!1,c.loadxdLocalStorage(),c.loadContextMenuGroupsHooks(),c.allowDisallowPasteAction()},loadxdLocalStorage:function(){xdLocalStorage.init({iframeUrl:"https://xstore.8theme.com/cross-domain-cp/index.html",initCallback:function(){}})},loadContextMenuGroupsHooks:function(){s.each(["section","widget","column"],function(e,t){elementor.hooks.addFilter("elements/"+t+"/contextMenuGroups",function(e,t){return c.prepareMenuItem(e,t)})})},prepareMenuItem:function(e,t){var n=_.findIndex(e,function(e){return"clipboard"===e.name});return e.splice(n+1,0,{name:"etheme-elementor-live-paste",actions:[{name:"etheme-live-paste",title:c.getText("live_paste"),icon:"eicon-copy",shortcut:"XStore",callback:function(){c.livePaste(t)}},{name:"etheme-live-copy-templates",title:c.getText("find_templates"),icon:"eicon-parallax",shortcut:"XStore",callback:function(){o.open("https://xstore.8theme.com/elementor/demos/minimal-fashion02/design-elements/","_blank")}}]}),e},allowDisallowPasteAction:function(){void 0!==DialogsManager.Widget.prototype.onShow&&(DialogsManager.Widget.prototype.onShow=function(){c.getContent()})},getContent:function(){xdLocalStorage.getItem("etheme-cross-domain-cp",function(e){e.value?(s(".elementor-context-menu-list__item-etheme-live-paste").removeClass("etheme-menu-list__item--disabled"),s(".elementor-etheme-live-paste").removeClass("etheme-elementor-add-section-area-button-disabled")):(s(".elementor-context-menu-list__item-etheme-live-paste").addClass("etheme-menu-list__item--disabled"),s(".elementor-etheme-live-paste").addClass("etheme-elementor-add-section-area-button-disabled")),c.hasContent=!!e.value})},getText:function(e){return etheme_cross_domain_cp_config.texts[e]},livePaste:function(r){return xdLocalStorage.getItem("etheme-cross-domain-cp",function(e){if(e.value){var o,e=JSON.parse(e.value),t=JSON.stringify(e),n=null,i={};if(c.templatePasteButton){let e=s(r.target).parents(".elementor-add-section"),t=e.prev(".elementor-top-section"),n=e.next(".elementor-top-section");t.length?i.at=t.index()+1:n.length&&(i.at=n.index()-1),o=elementor.getPreviewContainer(),e.find(".elementor-add-section-close").click()}else{switch(r.model.get("elType")){case"column":n=r.getContainer().parent;break;case"widget":n=r.getContainer().parent.parent;break;case"section":n=r.getContainer()}if(null===n)return;n.model.attributes.isInner&&(n=n.parent.parent),o=n.parent,i.at=n.view.getOption("_index")+1}var a={elType:"section",settings:e.settings,elements:e.elements,isInner:!1},l=(elementor.channels.data.trigger("element:before:add",{elType:"section"}),$e.run("document/elements/create",{container:o,model:a,options:i}));elementor.channels.data.trigger("element:after:add"),s.each(["fa-solid","fa-regular"],function(e,t){elementor.helpers.enqueueIconFonts(t)}),s.ajax({url:etheme_cross_domain_cp_config.ajax_url,method:"POST",data:{action:"etheme_cross_domain_cp_import",data:t,nonce:etheme_cross_domain_cp_config.nonce},beforeSend:function(){l.view.$el.append('<div class="etheme-cross-domain-cp-ixporting">'+c.getText("processing")+"</div>")}}).done(function(e){e.success&&(e=e.data[0],a.settings=e.settings,a.elType=e.elType,"widget"===e.elType?a.widgetType=e.widgetType:a.elements=e.elements,setTimeout(function(){$e.run("document/elements/delete",{container:l});$e.run("document/elements/create",{model:a,container:o,options:i})},800),s(".etheme-cross-domain-cp-ixporting").remove())}),c.templatePasteButton=!1}else alert(c.getText("not_allowed"))})}},e=navigator.userAgent;function i(e){let t=e.find(".elementor-add-new-section .elementor-add-section-drag-title");t.length&&t.before('<div class="elementor-add-section-area-button elementor-etheme-live-paste" title="'+etheme_cross_domain_cp_config.texts.live_paste+'">\n\t\t\t\t<i class="eicon-copy"></i>\n\t\t\t</div>')}function a(e){let t=e.find(".elementor-select-preset-list");t.length&&t.after('<div class="elementor-add-section-drag-title elementor-etheme-add-section-title">'+etheme_cross_domain_cp_config.texts.live_paste_info+"</div>")}e=-1<e.indexOf("Firefox")?"Mozilla Firefox":-1<e.indexOf("Opera")?"Opera":-1<e.indexOf("Trident")?"Microsoft Internet Explorer":-1<e.indexOf("Edge")?"Microsoft Edge":-1<e.indexOf("Chrome")?"Google Chrome or Chromium":-1<e.indexOf("Safari")?"Apple Safari":"unknown",-1<s.inArray(e,["Apple Safari","unknown"])||o.elementor&&(c.init(),o.elementor.on("preview:loaded",function(){var e=o.elementor.$previewContents,t=setInterval(function(){i(e),a(e),0<e.find(".elementor-add-new-section").length&&clearInterval(t)},100);e.on("click.onAddElement",".elementor-editor-section-settings .elementor-editor-element-add",function(e){let t=s(this).closest(".elementor-top-section"),n=t.prev(".elementor-add-section");c.templatePasteButton=!0,n.find(".elementor-etheme-live-paste").length||i(n),n.find(".elementor-etheme-add-section-title").length||a(n)}),e.on("click.onAddTemplateButton",".elementor-etheme-live-paste",function(e){c.templatePasteButton=!0,c.livePaste(e)})}.bind(this)))}(window,(document,jQuery),xdLocalStorage);