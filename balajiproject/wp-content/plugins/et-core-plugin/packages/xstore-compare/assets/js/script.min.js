!function(C){"use strict";etTheme.autoinit.XStoreCompare=etTheme.XStoreCompare=function(){var p,m,a,u,n,c,d,l,_,t,f,o;function h(r,i,s){r<i?C(s[r]).hasClass("processing")||(C(s[r]).trigger("click").addClass("processing"),C(document.body).on("added_to_cart",function(e,t,a,o){o.attr("data-product_id")==C(s[r]).attr("data-product_id")&&(o.removeClass("processing in-process"),h(++r,i,s))})):C(s[r-1]).parent().hasClass("keeper-all-products-buttons")&&C(".et_b_header-compare").find("li").unblock()}function g(e,t,a){e<t&&(C(a[e]).hasClass("processing")||C(a[e]).trigger("click",{is_multiple:!0,i:e,max:t,buttons:a}).addClass("processing"))}function x(e,t,a){var o;e<t&&(o=_?"in-process":"processing",C(a[e]).hasClass(o)||C(a[e]).trigger("click",{is_multiple:!0,i:e,max:t,buttons:a}).addClass(o))}function b(){if(a)return a;{C.ajax({url:xstore_compare_params.ajaxurl,dataType:"json",method:"POST",data:{cookie_key:m,action:"xstore_get_user_compare"},success:function(e){return a=e.products.products.map(e=>JSON.stringify(e))},error:function(){},complete:function(){}});let e=etTheme.getCookie(m);return e?e.split("|"):[]}}function v(){if(a)return a.map(e=>JSON.parse(e).id);{C.ajax({url:xstore_compare_params.ajaxurl,dataType:"json",method:"POST",data:{cookie_key:m,action:"xstore_get_user_compare"},success:function(e){var t=e.products.products;return a=e.products.products.map(e=>JSON.stringify(e)),t},error:function(){},complete:function(){}});let e=etTheme.getCookie(m);return e?e.split("|").map(e=>JSON.parse(e).id):[]}}function k(e,a={}){e=parseInt(e);var o=b(),t=o.map(e=>JSON.parse(e).id).indexOf(e);if(-1<t){if(o.splice(t,1),etTheme.setCookie(m,o.join("|")),a.table_row)a.table_row.css({position:"relative",zoom:1}),a.table_row.find("td:last-child").block({message:null,overlayCSS:{opacity:.6}}).attr("style",null),_?setTimeout(function(){a.table_row.remove()},1500):(a.table_row.find("td:last-child").unblock(),setTimeout(function(){a.table_row.attr("style",null)},500));else if(a.table_cols&&_){let t=a.table_cols.first().parents(".xstore-compare-table");t.block({message:null,overlayCSS:{opacity:.6}}),setTimeout(function(){o.length<4?a.table_cols.each(function(){C(this).attr("data-product_id","ghost-product-"+(4-o.length)),C(this).hasClass("xstore-compare-product")?C(this).html('<span class="xstore-compare-image">'+xstore_compare_params.placeholder_image+"</span>"):C(this).html(""),C(this).parent().append(C(this).remove())}):a.table_cols.each(function(){C(this).remove()})}),setTimeout(function(){t.unblock().removeClass("processing").attr("style",null);var e=t.parent();r(e,"horizontal")||e.find(".xstore-compare-table-arrow").remove()},500)}C(document).find("."+p+"[data-id="+e+"]").each(function(){a.table_row||C(this).addClass("processing"),f(C(this),JSON.parse(C(this).attr("data-settings")),"remove")}),a.minicompare&&a.liItem.block({message:null,overlayCSS:{opacity:.6}}),xstore_compare_params.is_loggedin&&(clearTimeout(u),u=setTimeout(function(){y(o.join("|"))},1500)),a.is_multiple?(a.i++,C(document).trigger("xstore_compare/removed_product",[o,e,a.is_multiple,a.i,a.max,a.buttons])):C(document).trigger("xstore_compare/removed_product",[o,e])}}function r(e,t){return"vertical"==t?e.get(0).scrollHeight>e.innerHeight():"horizontal"==t&&e.get(0).scrollWidth>e.innerWidth()}function y(e){C.ajax({url:xstore_compare_params.ajaxurl,dataType:"json",method:"POST",data:{action:"xstore_update_user_compare",cookie_key:m,products:e},success:function(e){},error:function(){},complete:function(){}})}function T(t){C.ajax({url:xstore_compare_params.ajaxurl,data:{products:t,products_count:t.length,action:"xstore_compare_fragments"},method:"POST",success:function(e){e&&e.fragments&&C.each(e.fragments,function(e,t){C(e).replaceWith(t)}),t.length<1?(C(".et_b_header-compare").find(".product_list-popup-footer-wrapper").hide(),_&&l&&C.ajax({url:xstore_compare_params.ajaxurl,data:{action:"xstore_empty_compare_page"},method:"POST",success:function(e){e&&e.page_content&&(C(document).find("form.xstore-compare-form").replaceWith(e.page_content),C(document).find(".xstore-compare-share").remove())}})):C(".et_b_header-compare").find(".product_list-popup-footer-wrapper").attr("style",null)}})}function i(e,t){e.length&&(t?(e.attr("data-o_id")||e.attr("data-o_id",e.data("id")),e.attr("data-id",t)):void 0!==e.attr("data-o_id")&&e.attr("data-id",e.attr("data-o_id")),o(e,parseInt(t)))}function s(e){void 0!==e.attr("data-o_id")&&(e.attr("data-id",e.attr("data-o_id")),o(e,e.attr("data-o_id")))}"undefined"!=typeof Cookies&&(etTheme.xstore_compare={},p="xstore-compare",m=xstore_compare_params.compare_id,a=null,c=n=u=0,d=etTheme.et_global.w_width<etTheme.et_global.mob_header_start||etConfig.layoutSettings.is_mobile?C(".mobile-header-wrapper"):C(".header-wrapper"),l=C("body").hasClass("xstore-compare-page"),_=C("body").hasClass("xstore-compare-owner"),t=0,C.ajax({url:xstore_compare_params.ajaxurl,dataType:"json",method:"POST",data:{cookie_key:m,action:"xstore_get_user_compare"},success:function(e){a=e.products.products.map(e=>JSON.stringify(e))},error:function(){},complete:function(){}}),C(document).on("click","."+p,function(e,t){e.preventDefault();var a=C(this).attr("data-action"),o=C(this).attr("data-id"),r=C(this).data("settings")||{},i=C(this).hasClass(p+"-redirect"),e=t&&!!t.is_multiple,s={},n=(e&&(s={is_multiple:!0,i:t.i,max:t.max,buttons:t.buttons}),C(this).parents("td"));switch((e||n)&&(s.table_cols=C(this).parents("table").find('td[data-product_id="'+o+'"]')),a){case"add":C(this).addClass("processing"),f(C(this),r,a);var c,[d,l={}]=[o,s];d=parseInt(d),-1===v().indexOf(d)&&((c=b()).push(JSON.stringify({id:d,time:Math.floor((new Date).getTime()/1e3)})),etTheme.setCookie(m,c.join("|"),xstore_compare_params.days_cache),l.table_row&&!_&&(l.table_row.css({position:"relative",zoom:1}),l.table_row.find("td:last-child").block({message:null,overlayCSS:{opacity:.6}}).attr("style",null),l.table_row.find("td:last-child").unblock(),setTimeout(function(){l.table_row.attr("style",null)},500)),xstore_compare_params.is_loggedin&&(clearTimeout(u),u=setTimeout(function(){y(c.join("|"))},1500)),C(document).find("."+p+"[data-id="+d+"]").each(function(){C(this).addClass("processing"),f(C(this),JSON.parse(C(this).attr("data-settings")))}),l.is_multiple?(l.i++,C(document).trigger("xstore_compare/added_product",[c,d,l.is_multiple,l.i,l.max,l.buttons])):C(document).trigger("xstore_compare/added_product",[c,d])),i&&C(this).addClass(p+"-redirect-ready");break;case"remove":i&&C(this).hasClass(p+"-redirect-ready")?window.location.href=xstore_compare_params.compare_page_url:(_||n||C(this).addClass("processing"),f(C(this),r,a),k(o,s))}}),f=function(e,t,a="add"){"add"==a?(t.removeText&&(e.find(".button-text").text(t.removeText),e.find(".mt-mes").text(t.removeText)),t.iconRemove&&t.iconRemove!=t.iconAdd&&e.find(".et-icon").addClass(t.iconRemove).removeClass(t.iconAdd),e.attr("data-action","remove"),e.attr("href",e.attr("href").replace("add_to_compare","remove_compare"))):(t.addText&&(e.find(".button-text").text(t.addText),e.find(".mt-mes").text(t.addText)),t.iconAdd&&t.iconAdd!=t.iconRemove&&e.find(".et-icon").addClass(t.iconAdd).removeClass(t.iconRemove),e.attr("data-action","add"),e.attr("href",e.attr("href").replace("remove_compare","add_to_compare"))),e.removeClass(p+"-redirect-ready"),setTimeout(function(){e.removeClass("processing"),e.removeClass("in-process")},300)},C(document).on("click",".xstore-minicompare-remove",function(e){e.preventDefault(),k(C(this).data("id"),{minicompare:!0,liItem:C(this).parents("li")})}),C(".xstore-compare-table :checkbox").on("click",function(){var e;"product-bulk-select"==C(this).attr("name")?C(this).closest("table").children("tbody").find(":checkbox").prop("checked",C(this).prop("checked")):(e=C(this).closest("tbody").find(':checkbox:not([name="product-bulk-select"])').filter(":visible:enabled").not(":checked"),C(this).closest("table").find(':checkbox[name="product-bulk-select"]').prop("checked",function(){return 0===e.length}))}),C(document).on("click",".xstore-compare-form .add-all-products",function(e){e.preventDefault(),confirm(xstore_compare_params.confirmQuestion)&&(etConfig.ajaxProductAddedNotify.type="alert",(e=C(this).closest(".xstore-compare-form").find("table").children("tbody").find(":checkbox").parents("tr").find(".ajax_add_to_cart")).length<1?alert(xstore_compare_params.no_products_available):h(0,e.length,e))}),C(document).on("click",".et_b_header-compare .add-all-products",function(e){var t;e.preventDefault(),confirm(xstore_compare_params.confirmQuestion)&&(etConfig.ajaxProductAddedNotify.type="alert",(t=(e=C(this).parents(".et_b_header-compare")).find(".keeper-all-products-buttons .ajax_add_to_cart")).length?(e.find("li").block({message:null,overlayCSS:{opacity:.6}}),h(0,t.length,t)):t.length<1&&alert(xstore_compare_params.no_products_available))}),C(".xstore-compare-actions").on("click",function(e){e.preventDefault();var a,t,o=!(etConfig.ajaxProductAddedNotify.type="alert"),r=!1,e=C(this).closest(".xstore-compare-form").find("table").children("tbody").find(":checkbox:checked"),r=[];if(e.parents("td").each(function(){var e=C(this).data("product_id");r.push(C(this).closest(".xstore-compare-form").find("table").children("tbody").find('td[data-product_id="'+e+'"]'))}),r.length<1)alert(xstore_compare_params.no_active_checkbox);else if(confirm(xstore_compare_params.confirmQuestion))switch(C(this).parent().find("select").val()){case"add":if(o?a=o.find(".ajax_add_to_cart"):r&&(a=[],r.forEach(function(e,t){e=C(e).find(".ajax_add_to_cart");e.length&&a.push(e)})),a.length<1)return void alert(xstore_compare_params.no_products_available);h(0,a.length,a);break;case"add_compare":o?a=o.find("."+p+'[data-action="add"]'):r&&(a=[],r.forEach(function(e,t){e=C(e).find("."+p+'[data-action="add"]');e.length&&a.push(e)})),a.addClass("in-process"),g(0,a.length,a);break;case"remove":o?a=o.find("."+p+'[data-action="remove"]"]'):r&&(a=[],r.forEach(function(e,t){e=C(e).find("."+p+'[data-action="remove"]');e.length&&a.push(e)})),_?(t=C(this).closest(".xstore-compare-form").find("table").children("tbody").find("td."+p+"-action[data-product_id]"),a.length==t.find("."+p).length?(etTheme.setCookie(m,"",0),xstore_compare_params.is_loggedin&&y([]),T([])):x(0,a.length,a)):(a.addClass("in-process"),x(0,a.length,a))}}),l&&C(".xstore-compare-table-wrapper").length&&(r(C(".xstore-compare-table-wrapper"),"horizontal")||C(".xstore-compare-table-wrapper").find(".xstore-compare-table-arrow").remove()),C(".xstore-compare-table-arrow").on("click",function(){{var t=C(this);let e=t.parent();var a=t.parent().find("tbody").find("tr:last-child td:last-child").outerWidth();return void("right"==t.data("side")?(t=a+e.scrollLeft(),e.animate({scrollLeft:t})):(t=a-e.scrollLeft(),e.animate({scrollLeft:-t})))}}),C(document).on("xstore_compare/removed_product",function(e,t,a,o,r,i,s){if(o&&r<i)setTimeout(function(){x(r,i,s)},1700);else if(clearTimeout(c),c=setTimeout(function(){T(t)},700),l&&void 0!==etTheme.quickView&&C(e.target.activeElement).parents(".et-quick-view-wrapper").length)etTheme.et_woocommerce.quick_view_opened&&etTheme.closeQuickView()}),C(document).on("xstore_compare/added_product",function(e,o,r,t,a,i,s){if(t&&a<i)setTimeout(function(){g(a,i,s)},1700);else switch(clearTimeout(c),c=setTimeout(function(){T(o)},700),clearTimeout(n),xstore_compare_params.notify_type){case"alert":etTheme.notify(etConfig.successfullyAdded);break;case"alert_advanced":C.ajax({url:xstore_compare_params.ajaxurl,data:{product_id:r,action:"xstore_get_compare_product_info"},method:"POST",success:function(e){var t=C("<a>",{class:"et-notify-image",href:e.product_link,target:"_self"}).html(e.product_image);let a=C("<div>",{class:"et-notify-info"}).html(e.product_title);e=C("<a>",{class:"et-notify-button",href:xstore_compare_params.compare_page_url}).html(xstore_compare_params.view_compare);a.append(e[0].outerHTML),etTheme.notify(t[0].outerHTML+a[0].outerHTML,"info",5e3,!0)}});break;case"mini_compare":let e=C(d).find(".et_b_header-compare.et_element-top-level"),t=C(d).find(".et_b_header-compare.et_element-top-level.et-off-canvas .et-mini-content"),a=C(d).find(".et_b_header-compare.et_element-top-level.et-off-canvas");a.length&&(etTheme.closeQuickView(),etTheme.showHideElementsOnCanvasActions(!0),etTheme.et_global.deny_link_click=!0,C(".et-mobile-panel-wrapper").addClass("outside")),e.addClass("active"),t.addClass("active"),a.addClass("et-content-shown"),n=setTimeout(function(){e.removeClass("active")},1e3)}}),C(document).on("found_variation","form.variations_form",function(e,t){e=C(e.target).closest(".product").find(".xstore-compare-single");e.length&&i(e,t.variation_id)}),C(document).on("reset_data","form.variations_form",function(e){e=C(e.target).closest(".product").find(".xstore-compare-single");e.length&&s(e)}),C(document).on("found_variation","div.st-swatch-in-loop",function(e,t){e=C(e.target).closest(".product").find(".xstore-compare");e.length&&i(e,t.variation_id)}),C(document).on("reset_data","div.st-swatch-in-loop",function(e){e=C(e.target).closest(".product").find(".xstore-compare");e.length&&s(e)}),C(document).on("change",".xstore-compare-form .xstore-compare-quantity .qty",function(){if(clearTimeout(t),0==C(this).val()){let e=C(this).parents("tbody").find('td[data-product_id="'+C(this).parents("td").data("product_id")+'"] .'+p+'[data-action="remove"]');t=setTimeout(function(){e.trigger("click")},1500)}}),o=etTheme.xstore_compare.switch_variation_button=function(e,t){-1===v().indexOf(t)?f(e,JSON.parse(e.attr("data-settings")),"remove"):f(e,JSON.parse(e.attr("data-settings")))})}}(jQuery);